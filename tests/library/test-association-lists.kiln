(load "library/test-framework")

{test-result {should {fail-to-get-when-empty}}
             {test (new list
                     (load "library/association-lists")
                     {new-list {list}}
                     (trigger {list (list {?l-op} {?get} {?set} {?rem})}
                       {l-op (list {get (list {foo} {rc} {rc "failed"})}
                                   {rc})}))}
             {expected-result {rc "failed"}}}

{test-result {should {get-after-set}}
             {test (new list
                     (load "library/association-lists")
                     {new-list {list}}
                     (trigger {list (list {?l-op} {?get} {?set} {?rem})}
                       {l-op (list {set (list {foo} "bar"
                                              {get (list {foo}
                                                         {rc}
                                                         {rc "failed to get"})})}
                                   {rc})}))}
             {expected-result {rc "bar"}}}

{test-result {should {fail-to-get-after-rem}}
             {test (new list
                     (load "library/association-lists")
                     {new-list {list}}
                     (trigger {list (list {?l-op} {?get} {?set} {?rem})}
                       {l-op (list (par {set (list {foo} "bar"
                                                   {rem (list {foo}
                                                              {removed}
                                                              {rc "failed to rem"})})}
                                        (trigger {removed ?x}
                                                 {get (list {foo}
                                                            {rc}
                                                            {rc "failed to get"})}))
                                   {rc})}))}
             {expected-result {rc "failed to get"}}}
